var url = require('url');
var querystring = require('querystring');
var request = require('hyperquest');

var PiwikClient = function(baseUrl, token) {

	var baseUrl = url.parse(baseUrl, true);
	this.settings = {};

    if (baseUrl.query && baseUrl.query.token_auth) {
      this.settings.token = baseUrl.query.token_auth;
    }
    if (token) {
      this.settings.token = token;
    }
    this.settings.apihost = baseUrl.hostname;
    this.settings.apipath = baseUrl.pathname;
  }
}

PiwikClient.prototype.api = function(vars, cb) {

	var that = this;

	if (typeof vars !== 'object') {
      vars = {};
    }

    vars.module = 'API';

    if (vars.format === null || vars.format === undefined) {
      vars.format = 'JSON';
    }

    //Allow overriding of token on per request basis
    if (vars.token_auth === null || vars.token_auth === undefined) {
      vars.token_auth = this.settings.token;
    }

    var req = hyperquest.get(that.settings.apipath + '?' + querystring.stringify(vars));

    req.on('response', function(response){
    	var data = ''
    	response.on('data', function(data){

    	})
    })

    req.on('error', function(error){

    })
};
